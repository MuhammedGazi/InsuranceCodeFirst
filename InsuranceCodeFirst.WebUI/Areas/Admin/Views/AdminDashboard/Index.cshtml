
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
    <div>
        <h2 class="text-2xl font-bold text-slate-900 tracking-tight">Genel Bakış</h2>
        <p class="text-slate-500 mt-1">Tekrar hoşgeldiniz, işte LifeSure'daki son durumlar.</p>
    </div>
    <div class="flex gap-3">
        <button class="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-medium text-slate-600 shadow-sm hover:bg-slate-50 hover:text-primary transition-all">
            <span class="material-symbols-outlined text-[20px]">cloud_download</span> Rapor İndir
        </button>
        <a href="/Admin/Policy/CreatePolicy" class="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium shadow-md shadow-primary/20 hover:bg-primary-hover transition-all">
            <span class="material-symbols-outlined text-[20px]">add</span> Yeni Poliçe
        </a>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div class="bg-white rounded-xl p-6 shadow-card hover:shadow-hover transition-all border border-slate-100 group">
        <div class="flex justify-between items-start mb-4">
            <div class="bg-blue-50 text-blue-600 p-3 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">policy</span>
            </div>
            <span class="flex items-center text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-[14px] mr-1">trending_up</span> +5%
            </span>
        </div>
        <div>
            <p class="text-slate-500 text-sm font-medium mb-1">Toplam Poliçe</p>
            <h3 class="text-3xl font-bold text-slate-800">2,450</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl p-6 shadow-card hover:shadow-hover transition-all border border-slate-100 group">
        <div class="flex justify-between items-start mb-4">
            <div class="bg-indigo-50 text-indigo-600 p-3 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">groups</span>
            </div>
            <span class="flex items-center text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-[14px] mr-1">trending_up</span> +12%
            </span>
        </div>
        <div>
            <p class="text-slate-500 text-sm font-medium mb-1">Aktif Müşteriler</p>
            <h3 class="text-3xl font-bold text-slate-800">1,820</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl p-6 shadow-card hover:shadow-hover transition-all border border-slate-100 group">
        <div class="flex justify-between items-start mb-4">
            <div class="bg-emerald-50 text-emerald-600 p-3 rounded-lg group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">payments</span>
            </div>
            <span class="flex items-center text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-[14px] mr-1">trending_up</span> +8%
            </span>
        </div>
        <div>
            <p class="text-slate-500 text-sm font-medium mb-1">Toplam Gelir</p>
            <h3 class="text-3xl font-bold text-slate-800">₺1.2M</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl p-6 shadow-card hover:shadow-hover transition-all border border-slate-100 group">
        <div class="flex justify-between items-start mb-4">
            <div class="bg-orange-50 text-orange-600 p-3 rounded-lg group-hover:bg-orange-600 group-hover:text-white transition-colors">
                <span class="material-symbols-outlined">pending_actions</span>
            </div>
            <span class="flex items-center text-xs font-bold text-red-500 bg-red-50 px-2 py-1 rounded-full">
                <span class="material-symbols-outlined text-[14px] mr-1">trending_down</span> -2%
            </span>
        </div>
        <div>
            <p class="text-slate-500 text-sm font-medium mb-1">Bekleyen İşlemler</p>
            <h3 class="text-3xl font-bold text-slate-800">45</h3>
        </div>
    </div>
</div>

<div class="bg-white rounded-2xl shadow-card border border-slate-100 overflow-hidden flex flex-col mt-6">
    <div class="overflow-x-auto">
        <div class="bg-white rounded-xl shadow-card border border-slate-100 p-6">
            <div class="mb-4">
                <h3 class="text-lg font-bold text-slate-900">Türkiye Haritası</h3>
                <p class="text-sm text-slate-500">İnteraktif il bazlı harita görünümü.</p>
            </div>

            <div id="turkeyMap" style="width: 100%; height: 600px;"></div>
        </div>
    </div>
</div>

<div class="bg-white rounded-2xl shadow-card border border-slate-100 overflow-hidden flex flex-col mt-6">
    <div class="overflow-x-auto">
        <div class="bg-white rounded-xl shadow-card border border-slate-100 p-6">
            <div class="mb-4">
                <h3 class="text-lg font-bold text-slate-900">Türkiye Haritası</h3>
                <p class="text-sm text-slate-500">İnteraktif il bazlı harita görünümü.</p>
            </div>

            <div id="turkeyMap1" style="width: 100%; height: 600px;"></div>
        </div>
    </div>
</div>

<div class="bg-white rounded-xl shadow-card border border-slate-100 p-6">
    <div class="mb-4">
        <h3 class="text-lg font-bold text-slate-900">Canlı Satış Performansı</h3>
        <p class="text-sm text-slate-500">Online Satış ve Acente Satışlarının anlık yarış grafiği.</p>
    </div>

    <div id="lineRaceChart" style="width: 100%; height: 500px;"></div>
</div>

<div class="bg-white rounded-xl shadow-card border border-slate-100 p-6">
    <div class="mb-4">
        <h3 class="text-lg font-bold text-slate-900">Canlı Prim Üretim Yarışı</h3>
        <p class="text-sm text-slate-500">İllerin anlık sigorta prim üretim sıralaması (Canlı Veri Simülasyonu)</p>
    </div>

    <div id="barRaceChart" style="width: 100%; height: 600px;"></div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

     <script type="text/javascript">
        // Harita elementini seç
        var chartDom = document.getElementById('turkeyMap');
        var myChart = echarts.init(chartDom);
        var option;

        myChart.showLoading();

        var geoJsonUrl = '@Url.Content("~/data/tr.json")';

        $.get(geoJsonUrl, function (geoJSON) {

            if (typeof geoJSON === 'string') {
                geoJSON = JSON.parse(geoJSON);
            }

            echarts.registerMap('turkey', geoJSON);

            option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}' // Sadece İl Adını Gösterir (Örn: Ankara)
                },
                geo: {
                    map: 'turkey',
                    roam: true, // Yakınlaştırma ve kaydırma açık
                    aspectScale: 0.8,
                    zoom: 1.2, // Başlangıç yakınlaştırma oranı
                    label: {
                        show: false // Harita üzerinde il isimleri kalabalık yapmasın diye kapalı
                    },
                    itemStyle: {
                        areaColor: '#f3f4f6', // Varsayılan Şehir Rengi (Açık Gri)
                        borderColor: '#64748b', // Sınır Çizgisi Rengi
                        borderWidth: 1
                    },
                    emphasis: {
                        disabled: false,
                        label: {
                            show: true,
                            color: '#ffffff' // Hover olunca yazı rengi beyaz
                        },
                        itemStyle: {
                            areaColor: '#3b82f6', // Mouse ile üzerine gelince MAVİ olsun
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.3)'
                        }
                    },
                    select: {
                        itemStyle: {
                            areaColor: '#2563eb' // Tıklanınca koyu mavi olsun
                        },
                        label: {
                            show: true,
                            color: '#fff'
                        }
                    }
                },
                // Series kısmını boş bıraktık çünkü üzerine grafik çizmiyoruz
                series: []
            };

            myChart.hideLoading();
            myChart.setOption(option);
        });

        window.addEventListener('resize', myChart.resize);
    </script>

    <script type="text/javascript">
        var chartDom = document.getElementById('turkeyMap1');
        var myChart = echarts.init(chartDom);
        var option;

        myChart.showLoading();

        var geoJsonUrl = '@Url.Content("~/data/tr.json")';

        $.get(geoJsonUrl, function (turkeyJson) {
            myChart.hideLoading();

            echarts.registerMap('turkey', turkeyJson);

            var data = [
                { name: 'Adana', value: 2274106 }, { name: 'Adıyaman', value: 604978 },
                { name: 'Afyonkarahisar', value: 751344 }, { name: 'Ağrı', value: 511238 },
                { name: 'Amasya', value: 339529 }, { name: 'Ankara', value: 5803482 },
                { name: 'Antalya', value: 2696249 }, { name: 'Artvin', value: 172356 },
                { name: 'Aydın', value: 1161702 }, { name: 'Balıkesir', value: 1273519 },
                { name: 'Bilecik', value: 228058 }, { name: 'Bingöl', value: 285655 },
                { name: 'Bitlis', value: 359747 }, { name: 'Bolu', value: 324789 },
                { name: 'Burdur', value: 277452 }, { name: 'Bursa', value: 3214571 },
                { name: 'Çanakkale', value: 570499 }, { name: 'Çankırı', value: 205501 },
                { name: 'Çorum', value: 524130 }, { name: 'Denizli', value: 1059082 },
                { name: 'Diyarbakır', value: 1818133 }, { name: 'Edirne', value: 419913 },
                { name: 'Elazığ', value: 604411 }, { name: 'Erzincan', value: 243399 },
                { name: 'Erzurum', value: 749993 }, { name: 'Eskişehir', value: 915418 },
                { name: 'Gaziantep', value: 2164134 }, { name: 'Giresun', value: 461712 },
                { name: 'Gümüşhane', value: 148539 }, { name: 'Hakkari', value: 287625 },
                { name: 'Hatay', value: 1544640 }, { name: 'Isparta', value: 449777 },
                { name: 'Mersin', value: 1938389 }, { name: 'İstanbul', value: 15655924 },
                { name: 'İzmir', value: 4479525 }, { name: 'Kars', value: 278335 },
                { name: 'Kastamonu', value: 388990 }, { name: 'Kayseri', value: 1445683 },
                { name: 'Kırklareli', value: 377156 }, { name: 'Kırşehir', value: 247179 },
                { name: 'Kocaeli', value: 2102907 }, { name: 'Konya', value: 2320641 },
                { name: 'Kütahya', value: 575674 }, { name: 'Malatya', value: 742725 },
                { name: 'Manisa', value: 1475716 }, { name: 'Kahramanmaraş', value: 1116618 },
                { name: 'Mardin', value: 888874 }, { name: 'Muğla', value: 1066736 },
                { name: 'Muş', value: 399879 }, { name: 'Nevşehir', value: 315994 },
                { name: 'Niğde', value: 377080 }, { name: 'Ordu', value: 775800 },
                { name: 'Rize', value: 350506 }, { name: 'Sakarya', value: 1098115 },
                { name: 'Samsun', value: 1377546 }, { name: 'Siirt', value: 347412 },
                { name: 'Sinop', value: 229716 }, { name: 'Sivas', value: 650401 },
                { name: 'Tekirdağ', value: 1167059 }, { name: 'Tokat', value: 606934 },
                { name: 'Trabzon', value: 824352 }, { name: 'Tunceli', value: 89317 },
                { name: 'Şanlıurfa', value: 2213964 }, { name: 'Uşak', value: 377001 },
                { name: 'Van', value: 1127612 }, { name: 'Yozgat', value: 420699 },
                { name: 'Zonguldak', value: 591492 }, { name: 'Aksaray', value: 438504 },
                { name: 'Bayburt', value: 86047 }, { name: 'Karaman', value: 263960 },
                { name: 'Kırıkkale', value: 285744 }, { name: 'Batman', value: 647205 },
                { name: 'Şırnak', value: 570745 }, { name: 'Bartın', value: 207238 },
                { name: 'Ardahan', value: 92819 }, { name: 'Iğdır', value: 209738 },
                { name: 'Yalova', value: 304780 }, { name: 'Karabük', value: 255242 },
                { name: 'Kilis', value: 155179 }, { name: 'Osmaniye', value: 557666 },
                { name: 'Düzce', value: 409865 }
            ];

            data.sort(function (a, b) {
                return a.value - b.value;
            });

            // ORİJİNAL RENK SKALASI
            const originalColors = ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026'];

            // 1. HARİTA AYARLARI
            const mapOption = {
                visualMap: {
                    left: 'right',
                    min: 0,
                    max: 16000000,
                    inRange: {
                        color: originalColors // Orijinal renkleri buraya atadık
                    },
                    text: ['Yüksek', 'Düşük'],
                    calculable: true
                },
                series: [
                    {
                        id: 'population',
                        type: 'map',
                        roam: true,
                        map: 'turkey',
                        aspectScale: 0.8, // HARİTA BOZULMASINI ÖNLEYEN AYAR
                        animationDurationUpdate: 1000,
                        universalTransition: true,
                        data: data
                    }
                ]
            };

            // 2. BAR GRAFİĞİ AYARLARI
            const barOption = {
                // Bar grafiği de aynı renkleri kullansın ama skala gizli olsun
                visualMap: {
                    show: false,
                    min: 0,
                    max: 16000000,
                    inRange: { color: originalColors }
                },
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    axisLabel: {
                        rotate: 0,
                        fontSize: 10
                    },
                    data: data.map(function (item) { return item.name; })
                },
                dataZoom: [
                    {
                        type: 'slider',
                        yAxisIndex: 0,
                        start: 80, // Sondan başla (en kalabalıklar)
                        end: 100,
                        width: 30,
                        right: 10,
                        handleSize: '100%'
                    },
                    {
                        type: 'inside',
                        yAxisIndex: 0,
                        start: 80,
                        end: 100
                    }
                ],
                grid: {
                    left: '20%',
                    right: '10%',
                    bottom: '10%',
                    top: '10%'
                },
                animationDurationUpdate: 1000,
                series: {
                    type: 'bar',
                    id: 'population',
                    data: data.map(function (item) { return item.value; }),
                    universalTransition: true
                    // itemStyle: { color: ... } KISMINI SİLDİK Kİ RENKLERİ VISUALMAP'TEN ALSIN
                }
            };

            let currentOption = mapOption;
            myChart.setOption(mapOption);

            // 5 saniyede bir geçiş yap
            setInterval(function () {
                currentOption = currentOption === mapOption ? barOption : mapOption;
                myChart.setOption(currentOption, true);
            }, 5000);
        });

        window.addEventListener('resize', myChart.resize);
    </script> 

    <script type="text/javascript">
        var chartDom = document.getElementById('lineRaceChart');
        var myChart = echarts.init(chartDom);
        var option;

        // Başlangıç verilerini oluşturuyoruz
        var dataOnline = [];
        var dataAgency = [];
        var categories = [];

        // Simülasyon için sayaç
        var count = 0;

        // Rastgele veri üreten fonksiyon (Önceki değere + ekleyerek artırır)
        function generateNextData(prevValue) {
            // -10 ile +20 arasında rastgele değişim
            var change = Math.floor(Math.random() * 31) - 10;
            var newValue = prevValue + change;
            // Eksiye düşmesin
            return newValue < 0 ? 0 : newValue;
        }

        // İlk 10 saniyelik veriyi doldur
        var lastOnline = 100;
        var lastAgency = 80;

        for (var i = 0; i < 20; i++) {
            categories.push('Saniye ' + i);
            lastOnline = generateNextData(lastOnline);
            lastAgency = generateNextData(lastAgency);
            dataOnline.push(lastOnline);
            dataAgency.push(lastAgency);
            count++;
        }

        option = {
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['Online Satış', 'Acente Satış']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: categories
            },
            yAxis: {
                type: 'value',
                boundaryGap: [0, '100%'],
                splitLine: {
                    show: false
                }
            },
            series: [
                {
                    name: 'Online Satış',
                    type: 'line',
                    showSymbol: false,
                    hoverAnimation: false,
                    data: dataOnline,
                    lineStyle: {
                        width: 4,
                        color: '#3b82f6' // Mavi
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(59, 130, 246, 0.5)' },
                            { offset: 1, color: 'rgba(59, 130, 246, 0.1)' }
                        ])
                    }
                },
                {
                    name: 'Acente Satış',
                    type: 'line',
                    showSymbol: false,
                    hoverAnimation: false,
                    data: dataAgency,
                    lineStyle: {
                        width: 4,
                        color: '#ef4444' // Kırmızı
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(239, 68, 68, 0.5)' },
                            { offset: 1, color: 'rgba(239, 68, 68, 0.1)' }
                        ])
                    }
                }
            ]
        };

        myChart.setOption(option);

        // CANLI YARIŞ KISMI (Her 1 saniyede bir güncellenir)
        setInterval(function () {
            // Eski veriyi (baştakini) sil
            categories.shift();
            dataOnline.shift();
            dataAgency.shift();

            // Yeni veri (sondakini) ekle
            categories.push('Saniye ' + count);

            // Son değerleri alıp üzerine ekleyerek devam ediyoruz
            var lastValOn = dataOnline[dataOnline.length - 1];
            var lastValAg = dataAgency[dataAgency.length - 1];

            dataOnline.push(generateNextData(lastValOn));
            dataAgency.push(generateNextData(lastValAg));

            count++;

            myChart.setOption({
                xAxis: {
                    data: categories
                },
                series: [
                    {
                        data: dataOnline
                    },
                    {
                        data: dataAgency
                    }
                ]
            });
        }, 1000); // 1000ms = 1 saniye

        window.addEventListener('resize', myChart.resize);
    </script> 

    <script type="text/javascript">
        var chartDom = document.getElementById('barRaceChart');
        var myChart = echarts.init(chartDom);
        var option;

        // Rastgele başlangıç verisi oluştur (15 İl için)
        // Sigorta primleri (TL cinsinden simüle edildi)
        var data = [
            { name: 'İstanbul', value: 45000 },
            { name: 'Ankara', value: 38000 },
            { name: 'İzmir', value: 32000 },
            { name: 'Bursa', value: 29000 },
            { name: 'Antalya', value: 27000 },
            { name: 'Kocaeli', value: 25000 },
            { name: 'Adana', value: 22000 },
            { name: 'Konya', value: 20000 },
            { name: 'Gaziantep', value: 19000 },
            { name: 'Mersin', value: 18000 },
            { name: 'Kayseri', value: 15000 },
            { name: 'Diyarbakır', value: 14000 },
            { name: 'Eskişehir', value: 13000 },
            { name: 'Trabzon', value: 12000 },
            { name: 'Samsun', value: 11000 }
        ];

        // Rastgele renk atamak için renk paleti
        const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1'];

        option = {
            xAxis: {
                max: 'dataMax', // En yüksek değere göre ölçekle
                axisLabel: {
                    formatter: function (n) {
                        return Math.round(n) + ''; // Virgülleri at
                    }
                }
            },
            yAxis: {
                type: 'category',
                inverse: true, // En yüksek değer en üstte olsun
                max: 9, // Sadece İLK 10 şehri göster (0'dan 9'a)
                axisLabel: {
                    show: true,
                    fontSize: 14,
                    fontWeight: 'bold',
                    formatter: function (value) {
                        return value;
                    }
                },
                animationDuration: 300,
                animationDurationUpdate: 300
            },
            series: [
                {
                    realtimeSort: true, // BU ÖZELLİK YARIŞI SAĞLAR
                    seriesLayoutBy: 'column',
                    type: 'bar',
                    data: data,
                    itemStyle: {
                        color: function (param) {
                            // Şehirlere ismine göre sabit renk ver (yer değişince renk değişmesin)
                            return colors[param.dataIndex % colors.length];
                        },
                        borderRadius: [0, 5, 5, 0] // Bar köşelerini yuvarla
                    },
                    label: {
                        show: true,
                        position: 'right',
                        valueAnimation: true, // Sayılar artarken animasyonlu dönsün
                        fontFamily: 'monospace',
                        formatter: '{c} TL'
                    }
                }
            ],
            // Animasyon Hız Ayarları (Yarışın akıcılığı için önemli)
            animationDuration: 0,
            animationDurationUpdate: 1000,
            animationEasing: 'linear',
            animationEasingUpdate: 'linear',
            grid: {
                left: '15%', // İsimler sığsın diye soldan boşluk
                right: '15%',
                top: 20,
                bottom: 20
            }
        };

        myChart.setOption(option);

        // SİMÜLASYON DÖNGÜSÜ
        setInterval(function () {

            // Her şehir için rastgele prim satışı ekle
            for (var i = 0; i < data.length; i++) {
                // 100 ile 2000 TL arası rastgele satış
                var randomSale = Math.floor(Math.random() * 2000) + 100;

                // Bazı şehirler şanslı olsun, daha hızlı artsın (Yarış heyecanı için)
                if (Math.random() > 0.9) {
                    randomSale += 3000;
                }

                data[i].value += randomSale;
            }

            // Grafiği güncelle
            myChart.setOption({
                series: [
                    {
                        type: 'bar',
                        data: data
                    }
                ]
            });
        }, 1500); // Her 1.5 saniyede bir güncelle

        window.addEventListener('resize', myChart.resize);
    </script>
}

